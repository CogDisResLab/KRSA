<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KRSA Vignette • KRSA</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="KRSA Vignette">
<meta property="og:description" content="KRSA">
<meta property="og:image" content="https://cogdisreslab.github.io/KRSA/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">KRSA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/KRSA.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CogDisResLab/KRSA" class="external-link">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>KRSA Vignette</h1>
            
      
      
      <div class="hidden name"><code>KRSA.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">KRSA</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">ggplot2</span> 3.3.5     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">purrr  </span> 0.3.4</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">tibble </span> 3.1.6     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">dplyr  </span> 1.0.8</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">tidyr  </span> 1.2.0     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">stringr</span> 1.4.0</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">readr  </span> 2.1.2     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="co">#&gt; <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com/" class="external-link">gt</a></span><span class="op">)</span> <span class="co"># can be used to view tables</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span> <span class="co"># can be used for parallel computing </span>
<span class="co">#&gt; Loading required package: future</span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>The Pamstation12 instrument provides a profiling of kinase activity of cell or tissue samples. The device is loaded with either serine/threonine or tyrosine microarray chips. Each chip has 4 wells so four samples can be loaded on a single chip, and the Pamstation12 can accommodate 3 chips per run. The microarray represents 144 (STK chip) or 196 (PTK chip) reporter peptides that can be phosphorylated by serine/threonine or tyrosine kinases. The device measures the degree of the phosphorylation in real time by detecting fluorescently labeled antibodies at different exposure times. The list of peptides present in each microarray can be viewed here: <a href="https://pamgene.com/wp-content/uploads/2020/09/STK-144-PamChip-87102.pdf" class="external-link">STK chip</a>, <a href="https://pamgene.com/wp-content/uploads/2020/09/PTK-196-PamChip-86402.pdf" class="external-link">PTK chip</a></p>
<div style="page-break-after: always;"></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"images/pamgene_workflow.png"</span><span class="op">)</span></code></pre></div>
<p><img src="images/pamgene_workflow.png" width="450px" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"images/pamgene_detectionFig.png"</span><span class="op">)</span></code></pre></div>
<p><img src="images/pamgene_detectionFig.png" width="450px" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level3">
<h3 id="run-design">Run Design<a class="anchor" aria-label="anchor" href="#run-design"></a>
</h3>
<p>Designing the placement of the samples on the chips and arrays is important to consider due to the variability across different chips and batches. During the run some wells are subject to fail and their data cannot be analyzed and shown below as red.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.5</span>,<span class="fl">2.5</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>,
  chips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">8</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,
  colr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span>,
  nms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">rundes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="fl">1</span>, xmax<span class="op">=</span><span class="fl">3</span>, ymin<span class="op">=</span><span class="fl">0</span>,ymax<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="fl">4</span>, xmax<span class="op">=</span><span class="fl">6</span>, ymin<span class="op">=</span><span class="fl">0</span>,ymax<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="fl">7</span>, xmax<span class="op">=</span><span class="fl">9</span>, ymin<span class="op">=</span><span class="fl">0</span>,ymax<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> 

<span class="va">rundes</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">chips</span>, <span class="va">num</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">colr</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">13</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">chips</span>,<span class="va">num</span>,label <span class="op">=</span> <span class="va">nms</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green3"</span>, <span class="st">"red3"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/design-1.png" width="288" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="section level3">
<h3 id="image-analysis">Image Analysis<a class="anchor" aria-label="anchor" href="#image-analysis"></a>
</h3>
<p>The first step of analyzing the run is to convert the images taken by the PamStation of each array at different exposure times to numerical values This is done by the Bionavigator software developed by Pamgene. The software recognizes the grid of the array with the aid of the searching algorithm (Pamgrid) to correctly identify each spot on the array. The numbers produced by this software represent the median value of the foreground pixels minus the median value of the background pixels to produce the median signal minus background (Median_SigmBg).</p>
</div>
<div class="section level3">
<h3 id="reading-data">Reading Data<a class="anchor" aria-label="anchor" href="#reading-data"></a>
</h3>
<p>The first step will be reading the crosstab view bionavigator files (Median_SigmBg and Signal_Saturation) and defining the PamChip type (STK or PTK). The raw data is read and then transformed to be in tidy format for an easier analysis, modeling, and visualizing.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Define chip type</span>
<span class="va">chipType</span> <span class="op">&lt;-</span> <span class="st">"STK"</span>

<span class="co"># Read crosstab view bionavigator files and tidy data</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/krsa_read.html">krsa_read</a></span><span class="op">(</span><span class="st">"data_files/example_Median_SigmBg.txt"</span>, <span class="st">"data_files/example_Signal_Saturation.txt"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="qc-initial-steps-and-groups-assignments">QC Initial Steps and Groups Assignments<a class="anchor" aria-label="anchor" href="#qc-initial-steps-and-groups-assignments"></a>
</h3>
<p>We will perform a couple of quality control steps to deal with negative values in the data and adjust based on signal saturation (optional). Next, we will define a new column to represent the grouping. And then, we will extract end point signal values</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># qc processing</span>
<span class="fu"><a href="../reference/krsa_qc_steps.html">krsa_qc_steps</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data</span>

<span class="co"># Define sample groups</span>
<span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="va">SampleName</span>, SampleName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">SampleName</span>,<span class="st">"_"</span> ,<span class="va">Barcode</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data</span>

<span class="co"># extract end level signal values @ all max exposure time (200ms)</span>
<span class="fu"><a href="../reference/krsa_extractEndPointMaxExp.html">krsa_extractEndPointMaxExp</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">chipType</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_pw_200</span>

<span class="co"># extract end level signal values end level @ all exposure times</span>
<span class="fu"><a href="../reference/krsa_extractEndPoint.html">krsa_extractEndPoint</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">chipType</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_pw</span> </code></pre></div>
</div>
<div class="section level3">
<h3 id="qc-steps-and-model-fitting">QC Steps and Model Fitting<a class="anchor" aria-label="anchor" href="#qc-steps-and-model-fitting"></a>
</h3>
<p>We will filter out peptides with low signals. In order to combine the values from different exposure times into a single value, a simple linear regression model of the <em>Medain_SigmBg</em> as a function of exposure time is fitted. The slope of of the model fit and <span class="math inline">\(R^2\)</span> are then used for quality control and samples comparison. The slope is also scaled by multiplying by 100 and log2 transformed (<em>Slope_Transformed</em>). We then filter out peptides with poor linear fit and references peptides.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Filter out peptides with low signals</span>
<span class="fu"><a href="../reference/krsa_filter_lowPeps.html">krsa_filter_lowPeps</a></span><span class="op">(</span><span class="va">data_pw_200</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ppPassAll</span>
<span class="co">#&gt; Filtered out 79 Peptides</span>

<span class="co"># Fit the linear model</span>
<span class="co"># This will produce a list of data frames:</span>
<span class="co"># scaled: the Slope_Transformed values (see above for more info on Slope_Transformed)</span>
<span class="co"># normalized: the Slope_Transformed values but normalized by Chip/Barcode</span>
<span class="co"># Grouped: The mean of Slope_Transformed values for all samples within a group</span>
<span class="fu"><a href="../reference/krsa_scaleModel.html">krsa_scaleModel</a></span><span class="op">(</span><span class="va">data_pw</span>, <span class="va">ppPassAll</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_modeled</span>
  
<span class="co"># Filter out peptides weak linear fit</span>
<span class="fu"><a href="../reference/krsa_filter_nonLinear.html">krsa_filter_nonLinear</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="fl">0.8</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ppPassR2</span>
<span class="co">#&gt; Filtered out 0 Peptides</span>

<span class="co"># Filter out reference peptides</span>
<span class="fu"><a href="../reference/krsa_filter_ref_pep.html">krsa_filter_ref_pep</a></span><span class="op">(</span><span class="va">ppPassR2</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">new_pep</span>
<span class="co">#&gt; Filtered out 10 Peptides</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="global-signal-intensity">Global Signal Intensity<a class="anchor" aria-label="anchor" href="#global-signal-intensity"></a>
</h3>
<p>For a global signal intensity across all samples/groups, few figures can be plotted based on the <em>Slope_Transformed</em> values.</p>
<div class="section level4">
<h4 id="global-cv-plots">Global CV Plots<a class="anchor" aria-label="anchor" href="#global-cv-plots"></a>
</h4>
<p>We will plot the coefficient of variation on both the normal and normalized fits. This will help us to identify groups with high variation that could be explained by sample outliers.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Plot a CV figure using the modeled scaled data</span>
<span class="fu"><a href="../reference/krsa_cv_plot.html">krsa_cv_plot</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="va">new_pep</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<p><img src="KRSA_files/figure-html/cvPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Plot a CV figure using the modeled normalized data</span>
<span class="fu"><a href="../reference/krsa_cv_plot.html">krsa_cv_plot</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">normalized</span>, <span class="va">new_pep</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<p><img src="KRSA_files/figure-html/cvPlot-2.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="global-violin-plots">Global Violin Plots<a class="anchor" aria-label="anchor" href="#global-violin-plots"></a>
</h4>
<p>We will plot violin figures to examine global signal differences between groups/samples.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot a violin figure and facet by the (Group) variable</span>
<span class="fu"><a href="../reference/krsa_violin_plot.html">krsa_violin_plot</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="va">new_pep</span>, <span class="st">"Group"</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/violinPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Plot a violin figure and facet by the (Barcode) variable</span>
<span class="fu"><a href="../reference/krsa_violin_plot.html">krsa_violin_plot</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="va">new_pep</span>, <span class="st">"Barcode"</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/violinPlot-2.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="global-heatmaps">Global Heatmaps<a class="anchor" aria-label="anchor" href="#global-heatmaps"></a>
</h4>
<p>The heatmap represent all the peptides present on the chip except the positive/internal controls and peptides that failed to pass QC. The heatmaps are scaled by row to highlight the peptide signal differences across the samples. A hierarchical unsupervised clustering is applied both on the peptides and the samples to potentially group similar signatures.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Generates a heatmap using the modeled scaled data</span>
<span class="fu"><a href="../reference/krsa_heatmap.html">krsa_heatmap</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="va">new_pep</span>, scale <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/heatmapPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Generates a heatmap using the modeled normalized data</span>
<span class="fu"><a href="../reference/krsa_heatmap.html">krsa_heatmap</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">normalized</span>, <span class="va">new_pep</span>, scale <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/heatmapPlot-2.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Generates a heatmap using the modeled grouped data</span>
<span class="fu"><a href="../reference/krsa_heatmap_grouped.html">krsa_heatmap_grouped</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">grouped</span>, <span class="va">new_pep</span>, scale <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/heatmapPlot-3.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="group-comparison">Group Comparison<a class="anchor" aria-label="anchor" href="#group-comparison"></a>
</h3>
<p>To compare between samples, a two-group comparison is performed. In this case, the two group comparisons are:</p>
<ul>
<li><strong>B vs A</strong></li>
</ul>
<p>The <em>Slope_Transforemed</em> ratio between each group, paired by chip, is calculated to the fold change. Based on the fold change, peptides that pass a certain fold change threshold are considered significant hits. Also, quality control steps applied in each comparison to filter out peptides that do not reach specific criteria:</p>
<ul>
<li>The <em>Medain_SigmBg</em> at max exposure <em>200ms</em> must be above a certain value<br>
</li>
<li>
<span class="math inline">\(R^2\)</span> of the linear model fit must be above a threshold value</li>
</ul>
<p>These <em>Filtering Parameters</em> (fold change threshold, QC criteria) can be modified to adjust the stringency of the analysis. The <em>Filtering Parameters</em> that are used for this analysis:</p>
<ul>
<li>The <em>Medain_SigmBg</em> at max exposure <em>200ms</em> must be equal or above 5<br>
</li>
<li>
<span class="math inline">\(R^2\)</span> of the linear model fit must be above or equal 0.8<br>
</li>
<li>Log fold change (LFC) cutoffs at (0.2,0.3)</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Define Groups to be compared</span>
<span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Comp1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># This function will run both QC steps (krsa_filter_lowPeps, krsa_filter_nonLinear) and krsa_filter_ref_pep</span>
<span class="fu"><a href="../reference/krsa_quick_filter.html">krsa_quick_filter</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_pw_200</span>, data2 <span class="op">=</span> <span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>,
    signal_threshold <span class="op">=</span> <span class="fl">5</span>, r2_threshold <span class="op">=</span> <span class="fl">0.9</span>,
    groups <span class="op">=</span> <span class="va">comparisons</span><span class="op">$</span><span class="va">Comp1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pep_passed_qc</span>
<span class="co">#&gt; Filtered out 65 Peptides</span>
<span class="co">#&gt; Filtered out 1 Peptides</span>
<span class="co">#&gt; Filtered out 10 Peptides</span>

<span class="co"># This function calculates log2 fold change values between the defined groups</span>
<span class="co"># The byChip argument lets you calculates the log2 fold change the results within each chip</span>
<span class="fu"><a href="../reference/krsa_group_diff.html">krsa_group_diff</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="va">comparisons</span><span class="op">$</span><span class="va">Comp1</span>, <span class="va">pep_passed_qc</span>, byChip <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">diff_df</span>

<span class="co"># save LFC table</span>
<span class="co">#write_delim(diff_df, "comp1_LFC_df.txt", delim = "\t")</span>

<span class="co"># Extract top peptides based on the LFC cutoff using average of LFCs across chips</span>
<span class="fu"><a href="../reference/krsa_get_diff.html">krsa_get_diff</a></span><span class="op">(</span><span class="va">diff_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>LFC_SD <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,<span class="va">LFC</span> ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"meanLFC"</span> <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sigPeps</span>

<span class="co"># Extract top peptides based on the LFC cutoff using average of LFCs across chips with a standard deviation cutoff (sd_thr). in this example the sd_thr is set as 0.5 but that could be adjusted by user (uncomment next line to account for LFC sd)</span>
<span class="co"># krsa_get_diff(diff_df,totalMeanLFC ,c(0.2,0.3), sd_thr = 0.5) %&gt;% list("meanLFC" = .) -&gt; sigPeps</span>

<span class="co"># Extract top peptides based on the LFC cutoff using per chip LFCs</span>
<span class="fu"><a href="../reference/krsa_get_diff_byChip.html">krsa_get_diff_byChip</a></span><span class="op">(</span><span class="va">diff_df</span>, <span class="va">LFC</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sigPepsPerChip</span>

<span class="co"># Combine the peptides hits in one list</span>
<span class="va">sigPeps_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sigPeps</span>, <span class="va">sigPepsPerChip</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>recursive <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>recursive <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<div style="page-break-after: always;"></div>
<div class="section level4">
<h4 id="b-vs-a-heatmap">B vs A (Heatmap)<a class="anchor" aria-label="anchor" href="#b-vs-a-heatmap"></a>
</h4>
<p>After applying the <em>Filtering Parameters</em> for this group comparison, only <em>56</em>/141 peptides carried forward in the analysis (i.e. <em>56 hits</em>). Below are some figures to visualize the differences between these samples for considering these <em>hits</em>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># generates a heatmap using the selected groups and peptides</span>
<span class="fu"><a href="../reference/krsa_heatmap.html">krsa_heatmap</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">normalized</span>, <span class="va">sigPeps</span><span class="op">$</span><span class="va">meanLFC</span><span class="op">$</span><span class="va">`0.2`</span>, groups <span class="op">=</span> <span class="va">comparisons</span><span class="op">$</span><span class="va">Comp1</span>, scale <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/heatmapInd-1.png" width="768" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="b-vs-a-violin-plot">B vs A (Violin Plot)<a class="anchor" aria-label="anchor" href="#b-vs-a-violin-plot"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># generates a violin plot using the selected groups and peptides</span>
<span class="fu"><a href="../reference/krsa_violin_plot.html">krsa_violin_plot</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="va">sigPeps</span><span class="op">$</span><span class="va">meanLFC</span><span class="op">$</span><span class="va">`0.2`</span>, <span class="st">"Barcode"</span>, groups <span class="op">=</span> <span class="va">comparisons</span><span class="op">$</span><span class="va">Comp1</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/violinIndPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># generate a grouped violin/boxplot plot using the selected groups and peptides with more options, like a statistical test. check krsa_violin_plot_grouped() arguments for more options</span>
<span class="fu"><a href="../reference/krsa_violin_plot_grouped.html">krsa_violin_plot_grouped</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">scaled</span>, <span class="va">sigPeps</span><span class="op">$</span><span class="va">meanLFC</span><span class="op">$</span><span class="va">`0.2`</span>, <span class="va">comparisons</span>, 
                         dots <span class="op">=</span> <span class="cn">F</span>,
                         groups <span class="op">=</span> <span class="va">comparisons</span><span class="op">$</span><span class="va">Comp1</span>, avg_line <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/violinIndPlot-2.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="fu"><a href="../reference/krsa_violin_plot_grouped.html">krsa_violin_plot_grouped</a></span><span class="op">(</span><span class="va">data_modeled</span><span class="op">$</span><span class="va">grouped</span>, <span class="va">sigPeps</span><span class="op">$</span><span class="va">meanLFC</span><span class="op">$</span><span class="va">`0.2`</span>, <span class="va">comparisons</span>, 
                         test <span class="op">=</span> <span class="cn">F</span>, 
                         groups <span class="op">=</span> <span class="va">comparisons</span><span class="op">$</span><span class="va">Comp1</span>, avg_line <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/violinIndPlot-3.png" width="768" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="b-vs-a-waterfall-plot">B vs A (Waterfall Plot)<a class="anchor" aria-label="anchor" href="#b-vs-a-waterfall-plot"></a>
</h4>
<p>This waterfall represents the log2 fold changes between the two groups at each peptide.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># generates a waterfall of the log2 fold change values for the selected peptide (top peptides)</span>
<span class="fu"><a href="../reference/krsa_waterfall.html">krsa_waterfall</a></span><span class="op">(</span><span class="va">diff_df</span>, lfc_thr <span class="op">=</span> <span class="fl">0.2</span>, byChip <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/waterfall-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># generates a waterfall of the log2 fold change values for the selected peptide (top peptides) with a standard deviation cutoff (sd_thr). This is just for the waterfall not the actual upstream kinase analysis (that must be set with the krsa_get_diff function)</span>
<span class="fu"><a href="../reference/krsa_waterfall.html">krsa_waterfall</a></span><span class="op">(</span><span class="va">diff_df</span>, lfc_thr <span class="op">=</span> <span class="fl">0.2</span>, byChip <span class="op">=</span> <span class="cn">T</span>, sd_thr <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/waterfall-2.png" width="768" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="b-vs-a-curve-plot">B vs A (Curve Plot)<a class="anchor" aria-label="anchor" href="#b-vs-a-curve-plot"></a>
</h4>
<p>We generate curves plots per peptide using the last cycle data to visualize the linear fit model</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># generates a curve plot representing the linear model fit for the selected peptide (top peptides, only showing 10 here)</span>
<span class="fu"><a href="../reference/krsa_curve_plot.html">krsa_curve_plot</a></span><span class="op">(</span><span class="va">data_pw</span>, <span class="va">sigPeps</span><span class="op">$</span><span class="va">meanLFC</span><span class="op">$</span><span class="va">`0.2`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, groups <span class="op">=</span> <span class="va">comparisons</span><span class="op">$</span><span class="va">Comp1</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/curvePlot-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="b-vs-a-upstream-kinase-analysis">B vs A (Upstream Kinase Analysis)<a class="anchor" aria-label="anchor" href="#b-vs-a-upstream-kinase-analysis"></a>
</h4>
<p>The lab carefully curated and mapped the kinases that can act and phosphorylate each peptide present on the chip. This was achieved by using multiple sources including GPS 3.0, Kinexus Phosphonet, PhosphoELM and PhosphoSite Plus. Based on that association between peptides and kinases, a random sampling analysis is performed for these hits. The basic idea of <em>KRSA</em> is: For each iteration (<em>2000</em> iterations performed in this analysis), the same number of hits are randomly selected from the total 141/or 193 peptides present on the chip. Predicted kinases are then mapped to this sample list of peptides and number of kinases are determined. The kinase count from the actual hits and random sampling is then compared to determine the significance.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="co"># load in chip coverage and kinase-substrate files OR upload your own files</span>
<span class="co"># if PTK chip, use:</span>
<span class="co"># chipCov &lt;- KRSA_coverage_PTK_PamChip_86402_v1</span>
<span class="co"># KRSA_file &lt;- KRSA_Mapping_PTK_PamChip_86402_v1</span>

<span class="co"># STK chip</span>
<span class="va">chipCov</span> <span class="op">&lt;-</span> <span class="va">KRSA_coverage_STK_PamChip_87102_v1</span>
<span class="va">KRSA_file</span> <span class="op">&lt;-</span> <span class="va">KRSA_Mapping_STK_PamChip_87102_v1</span>



<span class="co"># run the KRSA function to do the random sampling analysis, set seed that can be used later to reproduce results, and choose number of iterations</span>
<span class="fu"><a href="../reference/krsa.html">krsa</a></span><span class="op">(</span><span class="va">sigPeps</span><span class="op">$</span><span class="va">meanLFC</span><span class="op">$</span><span class="va">`0.2`</span>, return_count <span class="op">=</span> <span class="cn">T</span>, seed <span class="op">=</span> <span class="fl">123</span>, itr <span class="op">=</span> <span class="fl">2000</span>,
     map_file <span class="op">=</span> <span class="va">KRSA_file</span>, cov_file <span class="op">=</span> <span class="va">chipCov</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">fin</span>

<span class="co"># View the Z score table</span>
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fin</span><span class="op">$</span><span class="va">KRSA_Table</span>,<span class="fl">25</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Kinase</th>
<th align="right">Observed</th>
<th align="right">SamplingAvg</th>
<th align="right">SD</th>
<th align="right">Z</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">DYRK</td>
<td align="right">13</td>
<td align="right">21.376</td>
<td align="right">2.877</td>
<td align="right">-2.912</td>
</tr>
<tr class="even">
<td align="left">NMO</td>
<td align="right">0</td>
<td align="right">4.376</td>
<td align="right">1.550</td>
<td align="right">-2.822</td>
</tr>
<tr class="odd">
<td align="left">DMPK</td>
<td align="right">48</td>
<td align="right">40.877</td>
<td align="right">2.650</td>
<td align="right">2.688</td>
</tr>
<tr class="even">
<td align="left">JNK</td>
<td align="right">12</td>
<td align="right">19.186</td>
<td align="right">2.750</td>
<td align="right">-2.613</td>
</tr>
<tr class="odd">
<td align="left">PLK</td>
<td align="right">11</td>
<td align="right">18.206</td>
<td align="right">2.762</td>
<td align="right">-2.608</td>
</tr>
<tr class="even">
<td align="left">PIM</td>
<td align="right">36</td>
<td align="right">28.273</td>
<td align="right">2.985</td>
<td align="right">2.589</td>
</tr>
<tr class="odd">
<td align="left">PKCH</td>
<td align="right">11</td>
<td align="right">6.436</td>
<td align="right">1.839</td>
<td align="right">2.481</td>
</tr>
<tr class="even">
<td align="left">AKT</td>
<td align="right">22</td>
<td align="right">15.884</td>
<td align="right">2.616</td>
<td align="right">2.338</td>
</tr>
<tr class="odd">
<td align="left">RIPK</td>
<td align="right">9</td>
<td align="right">15.052</td>
<td align="right">2.603</td>
<td align="right">-2.326</td>
</tr>
<tr class="even">
<td align="left">CDK</td>
<td align="right">34</td>
<td align="right">39.757</td>
<td align="right">2.621</td>
<td align="right">-2.197</td>
</tr>
<tr class="odd">
<td align="left">ERK</td>
<td align="right">17</td>
<td align="right">23.363</td>
<td align="right">2.912</td>
<td align="right">-2.186</td>
</tr>
<tr class="even">
<td align="left">MAPKAPK</td>
<td align="right">25</td>
<td align="right">19.443</td>
<td align="right">2.726</td>
<td align="right">2.039</td>
</tr>
<tr class="odd">
<td align="left">P38</td>
<td align="right">15</td>
<td align="right">20.689</td>
<td align="right">2.853</td>
<td align="right">-1.994</td>
</tr>
<tr class="even">
<td align="left">RAD53</td>
<td align="right">18</td>
<td align="right">13.145</td>
<td align="right">2.468</td>
<td align="right">1.967</td>
</tr>
<tr class="odd">
<td align="left">STE11</td>
<td align="right">1</td>
<td align="right">3.928</td>
<td align="right">1.504</td>
<td align="right">-1.947</td>
</tr>
<tr class="even">
<td align="left">STE7</td>
<td align="right">15</td>
<td align="right">20.259</td>
<td align="right">2.803</td>
<td align="right">-1.876</td>
</tr>
<tr class="odd">
<td align="left">PKN</td>
<td align="right">2</td>
<td align="right">0.803</td>
<td align="right">0.695</td>
<td align="right">1.721</td>
</tr>
<tr class="even">
<td align="left">RSK</td>
<td align="right">38</td>
<td align="right">32.988</td>
<td align="right">2.985</td>
<td align="right">1.679</td>
</tr>
<tr class="odd">
<td align="left">PAKB</td>
<td align="right">2</td>
<td align="right">0.821</td>
<td align="right">0.704</td>
<td align="right">1.674</td>
</tr>
<tr class="even">
<td align="left">AMPK</td>
<td align="right">13</td>
<td align="right">9.453</td>
<td align="right">2.186</td>
<td align="right">1.623</td>
</tr>
<tr class="odd">
<td align="left">PAKA</td>
<td align="right">17</td>
<td align="right">13.136</td>
<td align="right">2.490</td>
<td align="right">1.552</td>
</tr>
<tr class="even">
<td align="left">IRAK</td>
<td align="right">3</td>
<td align="right">5.556</td>
<td align="right">1.690</td>
<td align="right">-1.512</td>
</tr>
<tr class="odd">
<td align="left">FRAY</td>
<td align="right">11</td>
<td align="right">7.939</td>
<td align="right">2.036</td>
<td align="right">1.504</td>
</tr>
<tr class="even">
<td align="left">PDHK</td>
<td align="right">29</td>
<td align="right">24.715</td>
<td align="right">2.909</td>
<td align="right">1.473</td>
</tr>
<tr class="odd">
<td align="left">PKA</td>
<td align="right">28</td>
<td align="right">23.789</td>
<td align="right">2.967</td>
<td align="right">1.419</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># to save file</span>
<span class="co">#fin$KRSA_Table %&gt;% write_delim("acrossChip_KRSA_FullTable_comp1.txt", delim = "\t")</span>

<span class="co"># find top and bottom kinases</span>
<span class="va">bothways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fin</span><span class="op">$</span><span class="va">KRSA_Table</span>, <span class="fl">10</span><span class="op">)</span>, <span class="va">Kinase</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">fin</span><span class="op">$</span><span class="va">KRSA_Table</span>, <span class="fl">10</span><span class="op">)</span>, <span class="va">Kinase</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Use these kinase to generate histogram plots for each selected kinase</span>
<span class="fu"><a href="../reference/krsa_histogram_plot.html">krsa_histogram_plot</a></span><span class="op">(</span><span class="va">fin</span><span class="op">$</span><span class="va">KRSA_Table</span>, <span class="va">fin</span><span class="op">$</span><span class="va">count_mtx</span>, <span class="va">bothways</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/krsa-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="co"># For parallel computing, load the furrr package:</span>
<span class="co"># opens multiple R sessions to run faster</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>

<span class="co"># Run the KRSA function across the different sets of peptides using the furrr package for parallel computing</span>
<span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html" class="external-link">future_map</a></span><span class="op">(</span><span class="va">sigPeps_total</span>, <span class="va">krsa</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">mutiple_krsa_outputs</span>


<span class="co"># For none parallel computing:</span>
<span class="co"># Run KRSA function across the different sets of peptides</span>
<span class="co">#map(sigPeps_total, krsa) -&gt; mutiple_krsa_outputs</span>

<span class="co"># Tidy output</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">mutiple_krsa_outputs</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">mutiple_krsa_outputs</span><span class="op">)</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="va">mutiple_krsa_outputs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mutiple_krsa_outputs</span><span class="op">$</span><span class="va">meanLFC.0.2</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"method"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Kinase</span>, <span class="va">Z</span>, <span class="va">method</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"\\w+\\.\\w+\\.\\w+"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"(^\\w+)[\\.]"</span>, <span class="st">"\\1&gt;"</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>

<span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">method</span>, values_from <span class="op">=</span> <span class="va">Z</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df2</span>
  
<span class="co"># Generates a table of the Z scores across the different sets of peptides</span>
<span class="co"># df2 %&gt;% </span>
<span class="co">#   gt() %&gt;% tab_spanner_delim(delim = "&gt;")</span>

<span class="co"># Creates an average Z score table using the across chip analysis</span>
<span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Kinase</span>, <span class="va">Z</span>, <span class="va">method</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Kinase</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AvgZ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">AvgZTable</span>

<span class="co"># save file</span>
<span class="co">#AvgZTable %&gt;% write_delim("acrossChip_KRSA_Table_comp1.txt", delim = "\t")</span>

<span class="co"># Creates an average Z score table using the within chip analysis</span>
<span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Kinase</span>, <span class="va">Z</span>, <span class="va">method</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Kinase</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AvgZ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">AvgZTable2</span>

<span class="co"># save file</span>
<span class="co">#AvgZTable %&gt;% write_delim("withinChip_KRSA_Table_comp1.txt", delim = "\t")</span>

<span class="co"># Extract top kinases based on abs(Z) score</span>
<span class="fu"><a href="../reference/krsa_top_hits.html">krsa_top_hits</a></span><span class="op">(</span><span class="va">AvgZTable2</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">kinases_hits</span>

<span class="co">#krsa_top_hits(AvgZTable2, 1.75)</span>
<span class="co">#krsa_top_hits(AvgZTable2, 1.5)</span>

<span class="co"># Show the number of peptides per each set in atable</span>
<span class="fu"><a href="../reference/krsa_show_peptides.html">krsa_show_peptides</a></span><span class="op">(</span><span class="va">sigPeps_total</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 2</span></span>
<span class="co">#&gt;   Method        NumberOfPeptides</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> meanLFC.0.2                 56</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> meanLFC.0.3                 53</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> meanLFC.0.4                 50</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 710317402.0.2               43</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 710317402.0.3               39</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 710317404.0.2               51</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 710317404.0.3               46</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span> 710317405.0.2               49</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">9</span> 710317405.0.3               45</span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="b-vs-a-z-scores-plot">B vs A (Z Scores Plot)<a class="anchor" aria-label="anchor" href="#b-vs-a-z-scores-plot"></a>
</h4>
<p>We will plot the individual and averaged Z scores using both the across and within chip analyses.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Generates Z scores waterfall plots</span>
<span class="fu"><a href="../reference/krsa_zscores_plot.html">krsa_zscores_plot</a></span><span class="op">(</span><span class="va">AvgZTable</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/zscoresPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/krsa_zscores_plot.html">krsa_zscores_plot</a></span><span class="op">(</span><span class="va">AvgZTable2</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/zscoresPlot-2.png" width="768" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="b-vs-a-reverse-krsa-plot">B vs A (Reverse KRSA Plot)<a class="anchor" aria-label="anchor" href="#b-vs-a-reverse-krsa-plot"></a>
</h4>
<p>We will use the reverse KRSA plot function, to plot the log2 fold chnage values for all peptides mapped to kinase hits. This will help us examine the activity of the kinase</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># plot the reverse KRSA figure for top kinases to determine their activity levels</span>
<span class="fu"><a href="../reference/krsa_reverse_krsa_plot.html">krsa_reverse_krsa_plot</a></span><span class="op">(</span><span class="va">chipCov</span>, <span class="va">diff_df</span>, <span class="va">kinases_hits</span>, <span class="fl">0.2</span>, byChip <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/revKRSAPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="b-vs-a-coverage-plot">B vs A (Coverage Plot)<a class="anchor" aria-label="anchor" href="#b-vs-a-coverage-plot"></a>
</h4>
<p>To view the coverage of kinases across the full list of peptides on the chip, we will use the coverage plot function</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># generates a kinase covergae plot </span>
<span class="fu"><a href="../reference/krsa_coverage_plot.html">krsa_coverage_plot</a></span><span class="op">(</span><span class="va">chipCov</span>, <span class="va">AvgZTable2</span>, <span class="va">chipType</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/covPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="b-vs-a-ball-model-network">B vs A (Ball Model Network)<a class="anchor" aria-label="anchor" href="#b-vs-a-ball-model-network"></a>
</h4>
<p>We will view the ball model network function, to generate a model representing the protein-protein interactions between kinases</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Plot the network ball model</span>
<span class="fu"><a href="../reference/krsa_ball_model.html">krsa_ball_model</a></span><span class="op">(</span><span class="va">kinases_hits</span>, <span class="va">AvgZTable2</span>, <span class="fl">10</span>, <span class="fl">2.5</span>, <span class="fl">4.8</span><span class="op">)</span></code></pre></div>
<p><img src="KRSA_files/figure-html/netPlot-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="section level5">
<h5 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h5>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">otherPkgs</span><span class="op">)</span>, <span class="st">"Version"</span><span class="op">]</span>
<span class="co">#&gt;         furrr        future            gt       forcats       stringr </span>
<span class="co">#&gt;       "0.2.3"      "1.24.0"       "0.4.0"       "0.5.1"       "1.4.0" </span>
<span class="co">#&gt;         dplyr         purrr         readr         tidyr        tibble </span>
<span class="co">#&gt;       "1.0.8"       "0.3.4"       "2.1.2"       "1.2.0"       "3.1.6" </span>
<span class="co">#&gt;       ggplot2     tidyverse         knitr          KRSA </span>
<span class="co">#&gt;       "3.3.5"       "1.3.1"        "1.38" "0.10.1.9000"</span></code></pre></div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Khaled Alganem.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
